---
title: "08_Maternal Mortality_eda"
author: "Group K"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Load required packages
library(tidyverse)
library(skimr)
library(ggplot2)
library(readr)
library(knitr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(summarytools)

```
# 1. Loading the dataset 

```{r load-data, message=FALSE}
#load dataset
dataset <- read_csv("../raw_data/maternal-mortality_national_zaf.csv", show_col_types = FALSE)
head(dataset,5)

```

## Dislay the first 5 rows
```{r}
kable(
  head(dataset[-1, c("ISO3", "DataId", "Indicator", "Value", "CountryName", "SurveyYear")], 5),
  caption = "First 5 rows of the Dataset "
)

```
# 2. Data Overview

## Summary statistics

```{r}
# 1. Remove first row if it's metadata/header
dataset_clean <- dataset[-1, ]  

# 2. Convert relevant numeric columns to numeric
numeric_cols <- c("Value", "DenominatorWeighted", "DenominatorUnweighted", "CILow", "CIHigh")

dataset_clean <- dataset_clean %>%
  mutate(across(all_of(numeric_cols), ~ as.numeric(as.character(.))))

# 3. Create a tidy summary table
summary_table <- dataset_clean %>%
  summarise(across(all_of(numeric_cols),
                   list(mean = ~mean(., na.rm = TRUE),
                        sd   = ~sd(., na.rm = TRUE),
                        min  = ~min(., na.rm = TRUE),
                        max  = ~max(., na.rm = TRUE)))) %>%
  pivot_longer(
    cols = everything(),
    names_to = c("Variable", "Statistic"),
    names_sep = "_",
    values_to = "Value"
  ) %>%
  arrange(Variable)

# Save summary table
write_csv(summary_table, "../outputs/summary tables/summary_maternalM.csv")

# Display
kable(summary_table, caption = "Summary Statistics for Key Numeric Variables in the  Dataset")
```

# 3. Data Quality 

## Missing values per column
```{r}
missing_values <- colSums(is.na(dataset))
missing_values
```

## Dupilcates
```{r}
duplicates <- sum(duplicated(dataset))
duplicates
```

# 4. Visualizations

## Bar plot showing the distribution of fertility-related indicators
```{r}
fertility_data <- dataset %>%
  filter(Indicator == "General fertility rate") %>%
  mutate(Value = as.numeric(Value),
         SurveyYear = as.factor(SurveyYear))

ggplot(fertility_data, aes(x = SurveyYear, y = Value, fill = SurveyYear)) +
  geom_bar(stat = "identity") +
  labs(title = "General Fertility Rate Across Surveys",
       x = "Survey Year",
       y = "Fertility Rate (per 1000 women)") +
  theme_minimal() +
  theme(legend.position = "none")
ggsave("../outputs/visuals/fertility_rate_barplot.png", width = 6, height = 4)

```

## Point plot with error bars to visualize the Pregnancy-related mortality ratio along with its lower and upper bounds.
```{r}
prmr_data <- dataset %>%
  filter(Indicator == "Pregnancy-related mortality ratio") %>%
  mutate(Value = as.numeric(Value),
         CILow = as.numeric(CILow),
         CIHigh = as.numeric(CIHigh),
         SurveyYear = as.factor(SurveyYear))

ggplot(prmr_data, aes(x = SurveyYear, y = Value)) +
  geom_point(size = 3, color = "red") +
  geom_errorbar(aes(ymin = CILow, ymax = CIHigh), width = 0.2) +
  labs(title = "Pregnancy-Related Mortality Ratio with 95% CI",
       x = "Survey Year",
       y = "Mortality Ratio") +
  theme_minimal()
ggsave("../outputs/visuals/prmr_pointplot.png", width = 6, height = 4)

```




