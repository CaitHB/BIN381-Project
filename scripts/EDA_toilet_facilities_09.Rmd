---
title: "EDA_toilet_facilities_09"
author: "Group K"
date: "`r Sys.Date()`"
output:   pdf_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Load required packages
library(tidyverse)
library(skimr)
library(ggplot2)
library(readr)
library(knitr)
library(dplyr)
library(tidyr)
library(summarytools)

dir.create("../outputs/visuals", recursive = TRUE, showWarnings = FALSE)
dir.create("../outputs/summary tables", recursive = TRUE, showWarnings = FALSE)
dir.create("../outputs/dictionary", recursive = TRUE, showWarnings = FALSE)
```
# 1. Loading the dataset 

```{r load-data, message=FALSE}
#load dataset
toilet_facilitiesDataset <- read_csv("../raw_data/toilet-facilities_national_zaf.csv", show_col_types = FALSE)
head(toilet_facilitiesDataset,5)

```
# 2. Data Overview

## Glimpse and summary statistics
```{r overview, message=FALSE}
summary(toilet_facilitiesDataset)
```

# 3. Data Quality 

## Missing values per column
```{r}
missing_values <- colSums(is.na(toilet_facilitiesDataset))
print(missing_values)
```

## Dupilcates
```{r}
duplicates <- sum(duplicated(toilet_facilitiesDataset))
if (duplicates > 0) {
  message(paste("Warning: Found", duplicates, "duplicate rows in the dataset."))
}
```
# 4. Visualizations

```{r}
# Keep only % indicators (exclude totals and counts)
lit_data <- toilet_facilitiesDataset %>%
  filter(IndicatorType == "I") %>%
  mutate(Value = as.numeric(Value),
         Gender = ifelse(grepl("^Women", Indicator), "Women", "Men"))

ggplot(lit_data, aes(x = Indicator, y = Value, fill = Gender)) +
  geom_col(position = "dodge") +
  coord_flip() +
  labs(
    title = "Toilet Facilities Indicators in South Africa (2016)",
    x = "Indicator",
    y = "Percentage"
  ) +
  theme_minimal()
ggsave("../outputs/visuals/toilet_facilitiesbarPLot.png", width = 6, height = 4)


```

# 5. Summary Tables

```{r}
# 1. Remove first row if it's metadata/header
toilet_facilities_clean <- toilet_facilitiesDataset[-1, ]  

# 2. Convert relevant numeric columns to numeric
numeric_cols <- c("Value", "DenominatorWeighted", "DenominatorUnweighted", "CILow", "CIHigh")

toilet_facilities_clean <- toilet_facilities_clean %>%
  mutate(across(all_of(numeric_cols), ~ as.numeric(as.character(.))))

# 3. Create a tidy summary table
summary_table <- toilet_facilities_clean %>%
  summarise(across(all_of(numeric_cols),
                   list(mean = ~mean(., na.rm = TRUE),
                        sd   = ~sd(., na.rm = TRUE),
                        min  = ~min(., na.rm = TRUE),
                        max  = ~max(., na.rm = TRUE)))) %>%
  pivot_longer(
    cols = everything(),
    names_to = c("Variable", "Statistic"),
    names_sep = "_",
    values_to = "Value"
  ) %>%
  arrange(Variable)

# Save summary table
write_csv(summary_table, "../outputs/summary tables/summary_toilet_facilities.csv")

# Display
kable(summary_table, caption = "Summary Statistics for Key Numeric Variables in the toilet_facilities Dataset")
```

