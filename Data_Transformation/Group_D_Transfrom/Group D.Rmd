---
title: "Group D"
author: "Group_K"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)

knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
# Load Group D data
data <- read_csv("merged datasets/GroupD_Social_merged.csv")

# Preview
head(data)
```


```{r}
# Filter out totals, denominators, and unweighted rows
data <- data %>%
  filter(!(IndicatorType %in% c("D", "U", "T")))
```


```{r}
# Transformations
# Create new variables and scale numeric columns
# Convert categorical variables to numeric factors
# Scale numeric variables
# Create weighted proportion variable
# Convert SurveyYear to factor
data <- data %>%
  mutate(
    IndicatorId_orig = IndicatorId,  # preserve original
    IndicatorType = as.numeric(factor(IndicatorType)),
    IndicatorId = as.numeric(factor(IndicatorId)),
    Value_scaled = scale(Value),
    DenominatorWeighted_scaled = scale(DenominatorWeighted),
    DenominatorUnweighted_scaled = scale(DenominatorUnweighted),
    Weighted_Proportion = DenominatorWeighted / DenominatorUnweighted,
    SurveyYearFactor = as.factor(SurveyYear)
  )
```


```{r}
# Aggregation
# Summarize average Value and total DenominatorWeighted by SurveyYear and IndicatorId_orig
agg_data <- data %>%
  group_by(SurveyYear, IndicatorId_orig) %>%
  summarise(
    Avg_Value = mean(Value, na.rm = TRUE),
    Total_Weighted = sum(DenominatorWeighted, na.rm = TRUE)
  )
```


```{r}
# Visualization 1: Average Value by Year
# 
ggplot(agg_data, aes(x=SurveyYear, y=Avg_Value, color=IndicatorId_orig, group=IndicatorId_orig)) +
  geom_line(size=1.1) +
  geom_point(size=2.5) +
  labs(
    title="Literacy & HIV Behaviour Indicators by Year",
    x="Survey Year",
    y="Average Value (%)",
    color="Indicator"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```


```{r}
# Visualization 2: Total Weighted Count by Year
ggplot(agg_data, aes(x=SurveyYear, y=Total_Weighted, fill=IndicatorId_orig)) +
  geom_col(position="dodge") +
  labs(
    title="Sample Size by Indicator and Year",
    x="Survey Year",
    y="Total Weighted Count",
    fill="Indicator"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust=1))

# save plots
ggsave("outputs/groupD_avg_value_by_year.png", width=10, height=6)
ggsave("outputs/groupD_total_weighted_by_year.png", width=10, height=6)
```
