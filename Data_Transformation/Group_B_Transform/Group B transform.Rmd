---
title: "Group B Transformation and Visualization"
author: "Group K"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
# Load necessary libraries
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(scales)

# Set options
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
# Load data
data <- read_csv("~/GitHub/BIN381-Project/merged datasets/GroupB_Sanitation_merged.csv") 

# Check first few rows
head(data)
```

```{r}

# Filtering
# Keep only relevant IndicatorIds
data <- data %>% 
filter(!(IndicatorType %in% c("T", "D", "U"))) # whas needed to remove totals/denominators/unweighted
```

```{r}
# Transformations
# Create new variables and scale numeric columns
# Convert categorical variables to numeric factors
# Scale numeric variables
# Create weighted proportion variable
# Convert SurveyYear to factor
data <- data %>%
  mutate(
    IndicatorId_orig = IndicatorId,
    IndicatorType = as.numeric(factor(IndicatorType)),
    IndicatorId = as.numeric(factor(IndicatorId)),
    Value_scaled = scale(Value),
    DenominatorWeighted_scaled = scale(DenominatorWeighted),
    DenominatorUnweighted_scaled = scale(DenominatorUnweighted),
    Weighted_Proportion = DenominatorWeighted / DenominatorUnweighted,
    SurveyYearFactor = as.factor(SurveyYear)
  )
```

```{r}

# Aggregation
# Summarize average Value and total DenominatorWeighted by SurveyYear and IndicatorId_orig
# Create aggregated dataset for visualizations
agg_data <- data %>%
  group_by(SurveyYear, IndicatorId_orig) %>%
  summarise(
    Avg_Value = mean(Value, na.rm = TRUE),
    Total_Weighted = sum(DenominatorWeighted, na.rm = TRUE)
  )
```

```{r}

# Visualization 1: Line chart
# Plot average Value over SurveyYear for each IndicatorId_orig
# Use different colors for each IndicatorId_orig the rambow one
ggplot(agg_data, aes(x=SurveyYear, y=Avg_Value, color=IndicatorId_orig, group=IndicatorId_orig)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  labs(
    title="Average Toilet Access by Year",
    x="Survey Year",
    y="Average Percentage",
    color="Toilet Type"
  ) +
  theme_minimal()

# Visualization 2: Bar chart
# Plot total DenominatorWeighted by SurveyYear for each IndicatorId_orig
# Use dodged bars for each IndicatorId_orig
# Rainbow color palette
ggplot(agg_data, aes(x=SurveyYear, y=Total_Weighted, fill=IndicatorId_orig)) +
  geom_col(position = "dodge") +
  labs(
    title="Total Weighted Population by Toilet Type and Year",
    x="Survey Year",
    y="Total Weighted Count",
    fill="Toilet Type"
  ) +
  theme_minimal()
# 
```